<div class="min-h-screen flex flex-col bg-[var(--Blanc)] text-[var(--Black)]">
  <div class="flex-1 max-w-7xl w-full mx-auto p-4 md:p-8 flex flex-col">

    <!-- ENTÊTE -->
    <header class="flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-6 border-3 border-[var(--Rouge-Clair)] pb-5 pt-5 pl-10 -ml-80 -mr-80 rounded-2xl">
      
      <!-- ========== H1 Planning ============= -->
      <div>
        <h1 class="text-4xl font-extrabold tracking-tight flex items-center gap-2">
          <i class="fas fa-calendar-alt"></i> <span>Planning</span>
        </h1>
        <p class="text-xl opacity-80 mt-1 italic">
          {{ viewMode === 'month' ? monthLabel() : weekLabel() }}
        </p>
      </div>


      <!-- ========== Bouton Mois et Semaine ============= -->
      <div class="absolute ml-210 flex items-center gap-4 flex-wrap">

        <!-- Toggle Mois / Semaine -->
        <div class="absolute -ml-51 bg-[var(--Blanc)] border-3 border-[var(--Rouge-Clair)] rounded-full p-1 shadow-lg flex gap-1">
          <button (click)="viewMode = 'month'"
                  class="px-5 py-2 rounded-full text-sm font-medium transition focus:outline-none"
                  [ngClass]="viewMode === 'month' ? 'bg-gradient-to-r from-[var(--Bleu)] to-[var(--Bleu-Clair)] text-[var(--Blanc)] shadow-md' : 'hover:text-[var(--Blanc)] hover:bg-[var(--Rouge-Foncé)]'">
            Mois
          </button>
          <button (click)="viewMode = 'week'"
                  class="px-5 py-2 rounded-full text-sm font-medium transition focus:outline-none"
                  [ngClass]="viewMode === 'week' ? 'bg-gradient-to-r from-[var(--Bleu)] to-[var(--Bleu-Clair)] text-[var(--Blanc)] shadow-md' : 'hover:text-[var(--Blanc)] hover:bg-[var(--Rouge-Foncé)]'">
            Semaine
          </button>
        </div>

        <!-- Navigation -->
        <div class="flex gap-2">
          <button (click)="viewMode === 'month' ? prevMonth() : prevWeek()"
                  class="flex items-center gap-2 px-4 py-2 rounded-full bg-[var(--Blanc)] text-[var(--Black)] border-3 border-[var(--Rouge-Clair)] shadow hover:bg-[var(--Rouge-Foncé)] hover:text-[var(--Blanc)] transition">
            <i class="fas fa-chevron-left"></i>
            <span>Précédent</span>
          </button>

          <button (click)="viewMode === 'month' ? nextMonth() : nextWeek()"
                  class="flex items-center gap-2 px-4 py-2 rounded-full bg-[var(--Blanc)] text-[var(--Black)] border-3 border-[var(--Rouge-Clair)] shadow hover:bg-[var(--Rouge-Foncé)] hover:text-[var(--Blanc)] transition">
            <span>Suivant</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>


        <!-- Bouton Créer -->
        <button (click)="openPopup()"
                class="flex items-center gap-2 px-6 py-2.5 rounded-full bg-gradient-to-r from-[var(--Rouge-Foncé)] via-[var(--Rouge)] to-[var(--Rouge-Clair)] text-[var(--Blanc)] font-semibold shadow-lg hover:shadow-xl hover:scale-105 transition">
          <span class="text-lg font-bold">+</span>
          <span class="hidden sm:inline">Créer</span>
        </button>
      </div>
    </header>

    <!-- ============== CONTENU ============== -->
    <div class="flex-1 bg-[var(--Blanc)] border-3 border-[var(--Rouge-Clair)] text-[var(--Black)] rounded-2xl shadow-xl pl-20 mb-50 md:p-6 overflow-hidden -ml-80 -mr-80">

      <!-- ========== VUE MOIS ========== -->
      <div *ngIf="viewMode === 'month'" class="grid grid-cols-7 gap-3 h-full">
        <div *ngFor="let day of monthDays"
            class="border-2 rounded-xl p-3 bg-[var(--Blanc)] shadow hover:shadow-lg transition flex flex-col group hover:scale-105 hover:border-[var(--Rouge-Clair)] 
                    min-h-[150px] h-[150px]">
          
          <!-- En-tête du jour -->
          <div class="font-bold mb-2 flex items-center justify-between">
            <span class="flex items-center justify-center w-10 h-10 rounded-full border-2 border-[var(--Rouge)]">
              {{ dayNum(day) }}
            </span>
          </div>

          <!-- Événements -->
          <div class="flex flex-col gap-1 overflow-y-auto custom-scroll flex-1">
            <div *ngFor="let evt of getEventsByDay(day)"
                class="text-xs rounded-lg px-2 py-1 cursor-pointer transition-transform flex items-center gap-2"
                [ngClass]="getEventClass(evt)"
                (click)="openDayPopup(day)">
              <i [ngClass]="getEventIcon(evt)"></i>
              <span class="font-semibold">{{ evt.hour }}</span> - {{ evt.title }}
            </div>
          </div>
        </div>
      </div>


      <!-- ========== VUE SEMAINE ========== -->
      <div *ngIf="viewMode === 'week'" class="grid grid-cols-7 gap-3 h-full">
        <div *ngFor="let day of weekDays"
             class="border rounded-xl bg-[var(--Blanc)] shadow hover:shadow-lg transition flex flex-col">
          <div class="font-bold p-3 border-b bg-[var(--Rouge)] text-[var(--Blanc)] rounded-t-xl sticky top-0 flex justify-between items-center">
            <span class="items-center justify-center">{{ dayName(day) }} {{ dayNum(day) }}</span>
            
          </div>

          <!-- Créneaux -->
          <div class="flex-1 overflow-y-auto custom-scroll pr-2">
            <div *ngFor="let hour of hours"
                class="min-h-[60px] border-b last:border-b-0 p-2 hover:bg-[var(--Rouge-Clair)] transition-colors relative group rounded-lg">
              
              <!-- Heure -->
              <div class="text-xs font-semibold text-[var(--Black)] mb-2">{{ hour }}</div>

              <!-- Événements -->
              <div *ngFor="let evt of getEventsByHour(day, hour)"
                  class="text-xs rounded-xl px-3 py-2 mb-2 hover:scale-105 transition-transform shadow-md flex flex-col gap-1 cursor-pointer"
                  [ngClass]="getEventClass(evt)"
                  (click)="openDayPopup(day)">
                
                <!-- Titre + Icône -->
                <div class="flex items-center gap-2">
                  <i [ngClass]="getEventIcon(evt)"></i>
                  <div class="font-medium truncate">{{ evt.title }}</div>
                </div>

                <!-- Catégorie + Durée -->
                <div class="text-[11px] opacity-80 flex items-center gap-1">
                  <span>{{ evt.category }}</span>
                  <span>·</span>
                  <span>{{ evt.duration }}</span>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- POPUP -->
    <div *ngIf="showPopup"
         class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4">
      <div class="bg-[var(--Blanc)] text-[var(--Black)] border-3 border-[var(--Rouge)] rounded-2xl shadow-2xl w-full max-w-lg p-6 space-y-5 animate-fade-in">
        <h3 class="text-xl font-bold border-b pb-2">
          {{ popupEvents.length === 0 ? 'Nouvel Événement' : 'Événements du ' + popupDay }}
        </h3>

        <!-- Liste des événements -->
        <div *ngIf="popupEvents.length > 0" class="space-y-3 max-h-64 overflow-y-auto pr-2 custom-scroll">
          <div *ngFor="let evt of popupEvents"
               class="p-3 bg-gray-50 rounded-lg shadow cursor-pointer hover:bg-gray-100 transition flex items-center gap-3">
            <i [ngClass]="getEventIcon(evt)" class="text-lg"></i>
            <div>
              <div class="font-semibold">{{ evt.title }}</div>
              <div class="text-xs text-gray-600">
                {{ evt.coach }} · {{ evt.category }} · {{ evt.hour }} · {{ evt.duration }}
              </div>
            </div>
          </div>
        </div>

        <!-- Formulaire création -->
<div *ngIf="popupEvents.length === 0" class="space-y-3">

  <input type="text" [(ngModel)]="newEventTitle" placeholder="Titre"
         class="w-full rounded-lg border p-3 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none" />

  <input type="text" [(ngModel)]="newEventCoach" placeholder="Coach"
         class="w-full rounded-lg border p-3 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none" />

  <!-- Sélecteur type d'événement -->
  <select [(ngModel)]="newEventType"
          class="w-full rounded-lg border p-3 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none">
    <option value="" disabled selected>Choisir un type</option>
    <option *ngFor="let type of eventTypes" [value]="type">
      {{ type }}
    </option>
  </select>

  <!-- Sélecteur catégorie d'âge/équipe -->
  <select [(ngModel)]="newEventCategory"
          class="w-full rounded-lg border p-3 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none">
    <option value="" disabled selected>Choisir une catégorie</option>
    <option *ngFor="let cat of ageCategories" [value]="cat">
      {{ cat }}
    </option>
  </select>

  <div class="flex gap-2">
    <input type="date" [(ngModel)]="newEventDate"
           class="rounded-lg border p-3 flex-1 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none" />
    <input type="time" [(ngModel)]="newEventHour"
           class="rounded-lg border p-3 w-28 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none" />
    <input type="number" min="1" max="8" [(ngModel)]="newEventDuration"
           class="rounded-lg border p-3 w-20 focus:ring-2 focus:ring-[var(--Bleu)] focus:outline-none" />
  </div>
</div>


        <!-- Actions -->
        <div class="flex justify-end gap-3 pt-2">
          <button (click)="closePopup()"
                  class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 transition">
            Fermer
          </button>
          <button *ngIf="popupEvents.length === 0" (click)="addEvent()"
                  class="px-4 py-2 rounded-lg bg-[var(--Bleu)] text-[var(--Blanc)] hover:bg-[var(--Bleu-Clair)] transition">
            Ajouter
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
@keyframes fade-in {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.animate-fade-in {
  animation: fade-in 0.3s ease-out;
}
.custom-scroll {
  scrollbar-width: thin;
  scrollbar-color: var(--Bleu) transparent;
}
.custom-scroll::-webkit-scrollbar {
  width: 6px;
}
.custom-scroll::-webkit-scrollbar-thumb {
  background: var(--Bleu);
  border-radius: 10px;
}
</style>
