<div class="-mt-16 min-h-screen flex flex-col p-4 sm:p-6 bg-[var(--Black)]/80 backdrop-blur-lg  text-[var(--Blanc)]">

  <!-- ========= HEADER CALENDRIER ========= -->
  <header
    class="mt-20 flex flex-col md:flex-row items-center justify-between gap-4 mb-6 p-4 bg-[var(--Gris)]/90 backdrop-blur-lg border border-[var(--Rouge-Clair)]/30 rounded-xl shadow-lg"
    role="banner">

    <!-- GAUCHE : TITRE + “AUJOURD’HUI” -->
    <div class="flex items-center gap-4">
      <!-- Titre du calendrier -->
      <h1 id="calendarTitle" aria-live="polite"
        class="text-2xl md:text-3xl font-bold tracking-tight text-[var(--Blanc)] drop-shadow-sm">
        {{ viewMode === 'month' ? monthLabel() : weekLabel() }}
      </h1>

      <!-- Bouton Aujourd'hui -->
      <button (click)="goToday()"
        class="hidden md:inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-full
           bg-[var(--Rouge)]/90 text-[var(--Blanc)] shadow-md backdrop-blur-sm
           hover:bg-[var(--Rouge-Foncé)] hover:scale-105
           transition-all duration-300
           focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)] focus:ring-offset-2 focus:ring-offset-[var(--Black)]">
        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
          <path fill-rule="evenodd"
            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.415L11 9.586V6z"
            clip-rule="evenodd" />
        </svg>
        Aujourd’hui
      </button>
    </div>

    <!-- DROITE : CONTROLES -->
    <nav class="flex flex-wrap items-center gap-3" role="group" aria-label="Contrôles calendrier">

      <!-- Mode vue -->
      <div
        class="inline-flex items-center gap-1 bg-[var(--Blanc)]/10 backdrop-blur-md rounded-xl p-1 shadow-md border border-[var(--Blanc)]/20">
        <!-- Bouton Mois -->
        <button (click)="viewMode='month'" [attr.aria-pressed]="viewMode === 'month'" class="px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-300
             focus:outline-none focus:ring-2 focus:ring-[var(--Rouge)]" [ngClass]="viewMode === 'month' 
        ? 'bg-[var(--Rouge)] text-[var(--Blanc)] shadow-md scale-105' 
        : 'bg-transparent text-[var(--Blanc)]/70 hover:bg-[var(--Blanc)]/10 hover:text-[var(--Blanc)]'">
          Mois
        </button>

        <!-- Bouton Semaine -->
        <button (click)="viewMode='week'" [attr.aria-pressed]="viewMode === 'week'" class="px-4 py-2 text-sm font-semibold rounded-lg transition-all duration-300
             focus:outline-none focus:ring-2 focus:ring-[var(--Rouge)]" [ngClass]="viewMode === 'week' 
        ? 'bg-[var(--Rouge)] text-[var(--Blanc)] shadow-md scale-105' 
        : 'bg-transparent text-[var(--Blanc)]/70 hover:bg-[var(--Blanc)]/10 hover:text-[var(--Blanc)]'">
          Semaine
        </button>
      </div>

      <!-- Navigation rapide -->
      <div class="flex items-center gap-2 md:gap-3">
        <!-- Bouton précédent -->
        <button (click)="viewMode==='month' ? prevMonth() : prevWeek()" aria-label="Période précédente" class="flex items-center gap-1 px-3 py-2 rounded-lg transition-all duration-200
             bg-[var(--Gris)]/20 hover:bg-[var(--Rouge)] text-[var(--Blanc)] font-medium shadow-sm
             hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          <span class="hidden sm:inline">Précédent</span>
        </button>

        <!-- Sélecteur de date -->
        <label for="jumpDate" class="flex items-center justify-center p-2 rounded-lg cursor-pointer
             transition-all duration-200 bg-[var(--Gris)]/20 hover:bg-[var(--Rouge)] shadow-sm
             hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"
          aria-label="Sélectionner une date">
          <svg class="w-5 h-5 text-[var(--Blanc)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </label>

        <!-- Bouton suivant -->
        <button (click)="viewMode==='month' ? nextMonth() : nextWeek()" aria-label="Période suivante" class="flex items-center gap-1 px-3 py-2 rounded-lg transition-all duration-200
             bg-[var(--Gris)]/20 hover:bg-[var(--Rouge)] text-[var(--Blanc)] font-medium shadow-sm
             hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]">
          <span class="hidden sm:inline">Suivant</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </div>

      <!-- Bouton Ajouter (desktop) -->
      <button *ngIf="canEdit()" (click)="openPopup()" class="hidden md:inline-flex items-center gap-2 px-5 py-2.5 rounded-full
           bg-gradient-to-b from-[var(--Rouge)] to-[var(--Rouge-Foncé)]
           hover:from-[var(--Bleu)] hover:to-[var(--Bleu-Foncé)]
           text-white font-semibold shadow-md hover:shadow-lg
           transition-all duration-200 hover:scale-105
           focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)] focus:ring-offset-2"
        aria-label="Créer un nouvel élément">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg>
        <span>Créer</span>
      </button>

    </nav>
  </header>


  <!-- BOUTON FLOTTANT MOBILE -->
  <button *ngIf="canEdit()" (click)="openPopup()"
    class="md:hidden fixed bottom-6 right-6 z-30 w-14 h-14 rounded-full bg-green-500 text-white shadow-lg grid place-items-center hover:bg-green-600 active:scale-95 transition-all duration-200 focus:outline-none focus:ring-4 focus:ring-green-400/50"
    aria-label="Ajouter un événement">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
    </svg>
  </button>

  <!-- MOIS VIEW -->
  <div *ngIf="viewMode==='month'" class="grid grid-cols-7 gap-2">
    <ng-container *ngFor="let day of monthDays">
      <div *ngIf="day" (click)="quickAddEvent(day,'09:00')" [ngClass]="{
            'bg-[var(--Rouge)]/30 hover:bg-[var(--Rouge)]/40': isToday(day),
            'hover:bg-[var(--Gris)]/20': !isToday(day)
          }"
        class="border min-h-[120px] md:min-h-[140px] p-3 md:p-4 relative rounded-xl cursor-pointer transition-colors duration-200">
        <!-- Nom du jour -->
        <div class="text-xs md:text-sm text-[var(--Blanc)]/70 mb-1">{{ dayName(day) }}</div>

        <!-- Numéro du jour -->
        <div class="text-sm md:text-base font-semibold text-[var(--Blanc)] mb-2">{{ dayNum(day) }}</div>

        <!-- Événements du jour -->
        <div *ngFor="let evt of getEventsByDay(day); let i = index"
          class="absolute mt-10 left-1 right-1 bg-[var(--Bleu)]/90 rounded-md px-2 py-1 text-xs md:text-sm
                    cursor-pointer overflow-hidden flex items-center gap-1 hover:bg-[var(--Bleu-Foncé)] transition-colors duration-200" [style.top.px]="30 + i * 28"
          (click)="openEventDetails(evt)">
          <i [class]="getEventIcon(evt) + ' text-[var(--Blanc)]'"></i>
          <span class="truncate">{{ evt.title }}</span>
        </div>

      </div>
    </ng-container>
  </div>



  <!-- Semaine VIEW -->
  <section *ngIf="viewMode === 'week'" class="flex flex-col w-full h-full" aria-label="Calendrier hebdomadaire">

    <!-- 1. HEADER (jours) -->
    <header class="flex w-full bg-[var(--Gris)] text-[var(--Blanc)] rounded-t-lg shadow-lg">
      <!-- Colonne vide pour les heures -->
      <div class="w-12"></div>

      <!-- Jours de la semaine -->
      <div class="flex-1 flex">
        <div *ngFor="let day of weekDays; let i = index" class="flex-1 border-l border-[var(--Blanc)]/20 flex flex-col items-center justify-center p-2 md:p-3 relative rounded-t-lg
                    transition-colors duration-200" [ngClass]="{
              'bg-[var(--Rouge)]/30 text-[var(--Blanc)] font-bold shadow-md': isToday(day),
              'hover:bg-[var(--Blanc)]/10': !isToday(day)
            }" [attr.aria-current]="isToday(day) ? 'date' : null">
          <span class="text-xs md:text-sm font-semibold tracking-wide">{{ weekDayHeaders[i] }}</span>
          <span class="text-sm md:text-base font-bold mt-1">{{ dayNum(day) }}</span>
        </div>
      </div>
    </header>


    <!-- 2. BODY (grille horaire) -->
    <main class="flex flex-1 overflow-auto bg-[var(--Gris)]">

      <!-- Hours column -->
      <div class="w-12 flex flex-col bg-[var(--Gris)] text-[var(--Blanc)]">
        <div *ngFor="let h of hours" class="h-14 flex items-start justify-end pr-1 border-b border-gray-700">
          <span class="text-xs">{{ h }}</span>
        </div>
      </div>

      <!-- Days columns -->
      <div class="flex-1 flex gap-1">
        <div *ngFor="let day of weekDays"
          class="flex-1 relative border-l border-[var(--Blanc)]/20 bg-[var(--Black)]/30 rounded-r-lg shadow-inner">

          <!-- Grid cells -->
          <div *ngFor="let h of hours; let j = index"
            class="h-14 border-b border-[var(--Blanc)]/10 hover:bg-[var(--Gris)]/20 transition-colors duration-200 cursor-pointer">
          </div>

          <!-- Events -->
          <article *ngFor="let evt of getEventsByDay(day)"
            class="absolute -left-0 -right-0 bg-[var(--Rouge)] px-2 py-1 text-xs md:text-sm font-medium text-[var(--Blanc)] cursor-pointer overflow-hidden shadow hover:shadow-lg flex justify-between items-center transition-all duration-200"
            [style.top.px]="getEventTopOffset(evt)" [style.height.px]="getEventHeight(evt)"
            [class.opacity-50]="isPast(day)" tabindex="0" role="button" [attr.aria-label]="evt.title"
            (click)="openEventDetails(evt)" (keyup.enter)="openEventDetails(evt)">
            <span class="flex items-center gap-1 truncate">
              <i [class]="getEventIcon(evt) + ' text-[var(--Blanc)]'"></i>
              {{ evt.title }}
            </span>
            <span class="text-[10px] md:text-xs font-mono ml-1">{{ evt.hour }} - {{ evt.endHour }}</span>
          </article>

        </div>
      </div>


    </main>
  </section>


<!-- POPUP ÉVÉNEMENT -->
<div *ngIf="showPopup" class="fixed inset-0 z-50 flex items-center justify-center bg-[var(--Black)]/60 backdrop-blur-lg p-4">
  <div class="w-full max-w-lg rounded-3xl bg-[var(--Blanc)]/10 backdrop-blur-2xl border border-[var(--Blanc)]/20 shadow-2xl p-8 text-[var(--Blanc)] relative">

    <!-- Bouton de fermeture -->
    <button (click)="showPopup=false" aria-label="Fermer"
            class="absolute top-4 right-4 p-2 rounded-full bg-[var(--Blanc)]/10 hover:bg-[var(--Rouge)]/40 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Titre -->
    <h2 class="text-2xl font-bold mb-6 bg-[var(--Rouge-Clair)] bg-clip-text text-transparent">
      {{ isEditing ? 'Modifier événement' : 'Ajouter événement' }}
    </h2>

    <!-- Champs formulaire -->
    <div class="flex flex-col gap-4 text-[var(--Blanc)]">
      <input type="text" placeholder="Titre" [(ngModel)]="newEventTitle"
             class="w-full p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"/>

      <input type="date" [(ngModel)]="newEventDate"
             class="w-full p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"/>

      <div class="flex gap-2">
        <input type="time" [(ngModel)]="newEventHour"
               class="w-1/2 p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"/>
        <input type="time" [(ngModel)]="newEventEndHour"
               class="w-1/2 p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"/>
      </div>

      <input type="text" placeholder="Prénom" [(ngModel)]="newEventCoach"
             class="w-full p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"/>

      <input type="text" placeholder="Catégorie" [(ngModel)]="newEventCategory"
             class="w-full p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"/>

      <textarea placeholder="Description" [(ngModel)]="newEventDescription" rows="4"
                class="w-full p-3 bg-[var(--Blanc)]/10 border border-[var(--Blanc)]/20 rounded-xl placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-[var(--Rouge-Clair)]"></textarea>
    </div>

    <!-- Boutons -->
    <div class="flex justify-end gap-4 mt-6">
      <button (click)="showPopup=false"
              class="px-5 py-2 rounded-xl bg-[var(--Blanc)]/20 hover:bg-[var(--Rouge)]/40 transition">
        Annuler
      </button>
      <button (click)="addEvent()"
              class="px-5 py-2 rounded-xl bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Foncé)] hover:from-[var(--Bleu)] hover:to-[var(--Bleu-Foncé)] text-white font-semibold shadow-lg hover:shadow-xl transition">
        {{ isEditing ? 'Modifier' : 'Ajouter' }}
      </button>
    </div>
  </div>
</div>


  <!-- DÉTAIL ÉVÉNEMENT -->
<div *ngIf="selectedEvent" class="fixed inset-0 z-50 flex items-center justify-center bg-[var(--Black)]/60 backdrop-blur-lg p-4">
  <div class="w-full max-w-lg rounded-3xl bg-[var(--Blanc)]/10 backdrop-blur-2xl border border-[var(--Blanc)]/20 shadow-2xl p-8 text-[var(--Blanc)] relative">

    <!-- Bouton de fermeture -->
    <button (click)="closeEventDetails()" aria-label="Fermer"
            class="absolute top-4 right-4 p-2 rounded-full bg-[var(--Blanc)]/10 hover:bg-[var(--Rouge)]/40 transition">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Titre -->
    <h2 class="text-2xl font-bold mb-2 bg-[var(--Rouge-Clair)] bg-clip-text text-transparent">
      {{ selectedEvent.title }}
    </h2>
    <p class="text-sm mb-4 text-[var(--Blanc)]/70">{{ selectedEvent.category }}</p>

    <!-- Contenu -->
    <div class="space-y-4 text-[var(--Blanc)]">
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 rounded-full bg-[var(--Rouge)] flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5 text-[var(--Blanc)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        <div>
          <p class="text-xs text-[var(--Blanc)]/60">Coach</p>
          <p class="font-medium">{{ selectedEvent.coach }}</p>
        </div>
      </div>

      <div class="flex items-start gap-3">
        <div class="w-10 h-10 rounded-full bg-[var(--Vert)]/20 flex items-center justify-center flex-shrink-0">
          <svg class="w-5 h-5 text-[var(--Vert)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
        </div>
        <div>
          <p class="text-xs text-[var(--Blanc)]/60">Date & heure</p>
          <p class="font-medium">{{ selectedEvent.day }} • {{ selectedEvent.hour }} - {{ selectedEvent.endHour }}</p>
        </div>
      </div>

      <div *ngIf="selectedEvent.description" class="pt-3 border-t border-[var(--Blanc)]/20">
        <p class="text-xs text-[var(--Blanc)]/60 mb-1">Description</p>
        <p class="leading-relaxed">{{ selectedEvent.description }}</p>
      </div>
    </div>

    <!-- Actions -->
    <div class="flex justify-end gap-3 mt-6">
      <button (click)="closeEventDetails()"
              class="px-5 py-2 rounded-xl bg-[var(--Blanc)]/20 hover:bg-[var(--Rouge)]/40 transition">
        Fermer
      </button>
      <button (click)="editEvent(selectedEvent)" *ngIf="canEdit()"
              class="px-5 py-2 rounded-xl bg-[var(--Bleu)] hover:bg-[var(--BleuFonce)] text-white font-semibold transition">
        Modifier
      </button>
      <button (click)="deleteEvent(selectedEvent)" *ngIf="canEdit()"
              class="px-5 py-2 rounded-xl bg-[var(--Rouge)] hover:bg-[var(--RougeFonce)] text-white font-semibold transition">
        Supprimer
      </button>
    </div>
  </div>
</div>


  <!-- NOTIFICATION --
  <div *ngIf="showSuccessMessage" class="fixed bottom-4 right-4 bg-[var(--Vert)] text-white px-4 py-2 rounded shadow">
    {{ successMessage }}
  </div>-->

</div>