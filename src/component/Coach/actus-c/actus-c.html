<div class="relative overflow-hidden ">


  <!-- Background Pattern -->
  <div class="absolute inset-0">
    <img src="assets/fondActus.jpg" class="w-full h-screen bg-[var(--Black)]/50 object-cover fixed top-0 left-0"
      style="background-repeat: no-repeat;">
  </div>


  <div class="relative z-10 space-y-6 max-w-3xl mx-auto p-4 py-8">

    <!-- Header Section -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold bg-[var(--Blanc)] bg-clip-text text-transparent mb-2">
        Actualités
      </h1>
      <p class="text-[var(--Blanc)] bg-[var(--Black)]/60 border-3 border-[var(--Blanc)] rounded-sm ml-50 mr-50 pl-5 pr-5 pt-3 pb-3">Partagez vos moments et restez connecté</p>
    </div>

    <!-- ===== BOUTON CRÉER UN POST ===== -->
    <div class="relative flex justify-center">
      <button (click)="openCreatePostModal()"
              class="group relative flex items-center justify-center gap-2 px-5 py-2 bg-white rounded-xl border-4 border-[var(--Rouge)]
                      hover:scale-115 transition-transform duration-300
                    text-[var(--Black)] hover:text-[var(--Rouge)] font-black text-xl">
        <i class="fa-solid fa-plus text-[var(--Black)]  group-hover:text-[var(--Rouge)] transition-colors"></i>
        <span>Créer un post</span>
      </button>
    </div>


    <!-- ===== MODAL CRÉER POST ===== ---->
    <div *ngIf="showCreateModal"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm flex justify-center items-center z-50">
      <div
        class="bg-[var(--Blanc)] backdrop-blur-md rounded-3xl w-full max-w-lg p-8 relative shadow-2xl border-3 border-[var(--Rouge)]">
        <button (click)="closeCreatePostModal()"
          class="absolute top-6 right-6 text-[#1f1f1f] opacity-50 hover:opacity-100 font-bold text-xl hover:rotate-90 transition-all">
          <i class="fa-solid fa-xmark"></i>
        </button>
        <h2 class="text-2xl font-bold mb-6 bg-[var(--Rouge)] bg-clip-text text-transparent">
          Nouveau post
        </h2>

        <textarea [(ngModel)]="newPostContent" placeholder="Quoi de neuf ?"
          class="w-full p-4 border-2 border-[var(--Rouge)] text-[var(--Gris)] font-bold rounded-xl mb-6 resize-none transition-all"
          rows="4">
        </textarea>

        <!-- PREVIEW MEDIA -->
        <div *ngIf="newPostMediaPreview" class="mb-6 relative group">
          <img *ngIf="newPostMedia?.type?.startsWith('image/')" [src]="newPostMediaPreview"
            class="rounded-xl max-h-80 w-full object-cover shadow-lg">
          <video *ngIf="newPostMedia?.type?.startsWith('video/')" [src]="newPostMediaPreview"
            class="rounded-xl max-h-80 w-full shadow-lg" controls></video>
          <button (click)="removeMedia()"
            class="absolute -top-2 -right-2 bg-[#8d0202] text-white rounded-full p-2 hover:bg-[#ca0303] shadow-lg transition-all hover:scale-110">
            <i class="fa-solid fa-xmark fa-xs"></i>
          </button>
        </div>

        <!-- ACTIONS -->
        <div class="flex items-center justify-between mb-6">
          <input type="file" #mediaInput class="hidden" (change)="onMediaSelected($event)" accept="image/*,video/*">
          <button (click)="openMediaSelector()"
            class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-[var(--Rouge)] bg-opacity-10 to-[var(--Rouge-Clair)] hover:from-[#040142] hover:to-[#06027e] bg-opacity-10 rounded-xl hover:from-opacity-20 hover:to-opacity-20 transition-all">
            <i class="fa-solid fa-image text-[var(--Blanc)]"></i>
            <span class="text-[var(--Blanc)] font-blod">Ajouter média</span>
          </button>
          <button (click)="createPost()" [disabled]="loading"
            class="px-6 py-2 bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Clair)] text-white rounded-xl hover:from-[#040142] hover:to-[#06027e] disabled:opacity-50 disabled:cursor-not-allowed transition-all font-medium shadow-lg hover:shadow-xl">
            <span *ngIf="!loading">Publier</span>
            <span *ngIf="loading" class="flex items-center gap-2">
              <i class="fa-solid fa-spinner fa-spin"></i> Publication...
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading / Aucun post ---->
    <div *ngIf="posts.length === 0 && !loading" class="text-center py-12">
      <i class="fa-solid fa-inbox fa-4x text-[#1f1f1f] opacity-40 mb-4"></i>
      <p class="text-[#1f1f1f] opacity-70 text-lg">Aucun post pour le moment</p>
      <p class="text-[#1f1f1f] opacity-50">Soyez le premier à partager quelque chose !</p>
    </div>

    <!-- ===== LISTE DES POSTS ===== -->
    <div *ngFor="let post of posts; let i = index"
      class="bg-[var(--Blanc)] rounded-xl hover:shadow-xl transition-all duration-300 p-6 space-y-4 relative border-3 border-[var(--Rouge)] group">
      <!-- ENTETE POST -->
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="relative">
            <div
              class="bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Clair)] text-white rounded-full w-12 h-12 flex items-center justify-center font-bold text-lg shadow-lg">
              {{ post.initials || currentInitiales }}
            </div>
            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-[var(--Rouge)] rounded-full border-2 border-[var(--Blanc)]"></div>
          </div>
          <div>
            <p class="font-bold text-[var(--Black)]">{{ post.user }}</p>
            <p class="text-[var(--Black)] opacity-60 text-sm flex items-center gap-1">
              <i class="fa-regular fa-clock fa-xs"></i>
              {{ post.createdAt | date:"d MMMM y 'à' HH'h'mm" : 'fr-FR' }}
            </p>
          </div>
        </div>
        <div class="relative">
          <button (click)="togglePostMenu(i)"
                  class="rounded-full pt-2 transition-all hover:scale-105">
            <i class="fa-solid fa-bars text-2xl text-[var(--Black)]"></i>
          </button>

          <div *ngIf="post.showMenu"
            class="absolute right-0 mt-2 w-40 bg-white/95 backdrop-blur-md border rounded-xl shadow-xl z-10 overflow-hidden">
            <button (click)="openEditModal(post)"
              class="w-full text-left px-4 py-3 text-[var(--Black)] hover:text-[var(--Blanc)] hover:bg-[var(--Bleu)] hover:bg-opacity-5 transition-colors flex items-center gap-2">
              <i class="fa-solid fa-pen-to-square fa-sm"></i>
              Modifier
            </button>
            <button (click)="deletePost(post, i)"
              class="w-full text-left px-4 py-3 text-[var(--Rouge)] hover:text-[var(--Blanc)] hover:bg-[var(--Rouge-Clair)] hover:bg-opacity-5 transition-colors flex items-center gap-2">
              <i class="fa-solid fa-trash fa-sm"></i>
              Supprimer
            </button>
          </div>
        </div>
      </div>

      <!-- CONTENU POST -->
      <p class="whitespace-pre-wrap text-[var(--Black)] text-xl leading-relaxed">{{ post.content }}</p>

      <!-- MEDIA -->
      <div *ngIf="post.mediaUrl" class="relative group overflow-hidden rounded-xl">
        <img *ngIf="post.mediaType === 'image'" [src]="post.mediaUrl"
          class="w-full max-h-96 object-cover transition-transform duration-300 group-hover:scale-105">
        <video *ngIf="post.mediaType === 'video'" [src]="post.mediaUrl" class="w-full max-h-96 rounded-xl"
          controls></video>
      </div>

      <!-- ACTIONS -->
      <div class="flex items-center justify-between text-[var(--Black)] opacity-60 pt-4 border-t border-[var(--Black)] border-opacity-5">
        
        <!-- LIKE -->
        <button (click)="toggleLike(post)"
                class="flex items-center gap-2 transition-all px-3 py-2 rounded-lg hover:scale-105">
          <i [ngClass]="post.isLiked ? 'fa-solid fa-heart text-[var(--Rouge)]' : 'fa-regular fa-heart text-[var(--Black)]'"
            class="text-xl transition-all"></i>
          <span [ngClass]="post.isLiked ? 'font-bold text-[var(--Rouge)]' : 'font-black text-[var(--Rouge)]'">
            {{ post.likes }}
          </span>
        </button>

        <!-- BOOKMARK -->
        <button (click)="bookmarkPost(post)"
                class="flex items-center gap-2 hover:text-[var(--Vert)] transition-all hover:scale-105 px-3 py-2 rounded-lg hover:bg-opacity-5">
          <i [ngClass]="post.isBookmarked ? 'fa-solid fa-bookmark text-[var(--Vert)]' : 'fa-regular fa-bookmark text-[var(--Black)] opacity-70'" 
            class="text-xl"></i>
        </button>

        <!-- SHARE -->
        <button (click)="sharePost(post)"
                class="flex items-center gap-2 hover:text-[var(--Bleu)] transition-all hover:scale-105 px-3 py-2 rounded-lg hover:bg-opacity-5">
          <i class="fa-solid fa-share-from-square text-xl"></i>
          <span class="font-medium">{{ post.shares }}</span>
        </button>
      </div>


      <!-- COMMENTAIRES -->
      <div class="space-y-3 pt-4 border-t border-[var(--Rouge)] border-opacity-5">
        <div *ngFor="let c of post.comments" class="flex items-start gap-3 bg-[var(--Blanc)] border-2 border-[var(--Rouge)] bg-opacity-5 rounded-lg p-3">
          <div
            class="bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Clair)] text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm flex-shrink-0">
            {{ c.initials || currentInitiales }}
          </div>
          <div class="flex-1">
            <p class="font-bold text-[#1f1f1f] text-sm">{{ c.user }}</p>
            <p class="text-[#1f1f1f] opacity-90">{{ c.text }}</p>
            <p class="text-[#1f1f1f] opacity-50 text-xs mt-1"><i class="fa-regular fa-clock fa-xs"></i> {{ c.time }}</p>
          </div>
        </div>
        <div class="flex gap-3 mt-4">
          <input [(ngModel)]="post.newComment" placeholder="Ajouter un commentaire..."
            class="flex-1 p-3 border-2 border-[#1f1f1f] border-opacity-10 rounded-xl transition-all"
            (keyup.enter)="addComment(post)">
          <button (click)="addComment(post)"
            class="px-4 py-2 bg-gradient-to-r from-[var(--Rouge)] to-[var(--Rouge-Clair)] text-white rounded-xl hover:from-[#040142] hover:to-[#06027e] transition-all font-medium shadow-lg hover:shadow-xl">
            <i class="fa-solid fa-paper-plane"></i>
          </button>
        </div>
      </div>

    </div>
  </div>
</div>