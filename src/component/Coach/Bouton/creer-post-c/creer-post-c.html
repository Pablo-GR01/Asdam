<!-- Contenu principal -->
<div class="relative z-10 max-w-3xl mx-auto px-4 sm:px-6 lg:px-0 py-8 space-y-6">

  <!-- ✅ Bouton compact : Créer un post -->
  <div class="flex justify-center mt-6 px-4 sm:px-6 lg:px-0" *ngIf="canCreatePost()">
    <button
      type="button"
      (click)="openCreatePostModal()"
      aria-label="Créer un nouveau post"
      class="group flex flex-col items-center justify-center w-28 h-28
            bg-gradient-to-br from-[var(--Rouge-Foncé)] to-[var(--Rouge)]
            text-[var(--Blanc)] font-semibold rounded-xl shadow-md
            hover:from-[var(--Bleu)] hover:to-[var(--Bleu-Foncé)]
            hover:shadow-lg hover:-translate-y-0.5 hover:scale-105
            transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-rose-400/40"
    >
      <i class="fa-solid fa-pen-to-square text-2xl mb-1 transition-transform duration-300 group-hover:rotate-12"></i>
      <span class="uppercase tracking-wide text-xs leading-tight">Créer</span>
      <span class="text-[10px] opacity-80">Post</span>
    </button>
  </div>

  <!-- Modal créer post -->
  <div *ngIf="showCreateModal"
    class="fixed inset-0 z-[1000] flex items-center justify-center p-4 sm:p-6 backdrop-blur-sm animate-fadeIn">

    <div class="w-full max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl rounded-2xl bg-[var(--Black)] shadow-2xl border border-gray-200/10 
                p-4 sm:p-6 md:p-8 text-[var(--Blanc)] relative animate-slideUp">

      <!-- Bouton fermer -->
      <button (click)="closeCreatePostModal()" aria-label="Fermer" class="absolute top-3 right-3 p-2 rounded-full bg-white/5 hover:bg-white/10 
                     text-gray-400 hover:text-white transition-all duration-200 group">
        <i class="fa-solid fa-xmark text-lg sm:text-xl group-hover:scale-110 transition-transform"></i>
      </button>

      <!-- Header -->
      <div class="mb-6">
        <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold text-[var(--Rouge-Clair)] mb-1">Créer un post</h2>
        <p class="text-sm sm:text-base text-gray-400">Partagez quelque chose avec votre communauté</p>
      </div>

      <!-- Corps du post -->
      <div class="space-y-4">

        <!-- Texte du post -->
        <div class="relative">
          <textarea [(ngModel)]="newPostContent" placeholder="Quoi de neuf ?" class="w-full p-3 sm:p-4 bg-white/5 border-2 border-transparent rounded-xl placeholder-gray-500
                   text-white resize-none focus:outline-none focus:border-[var(--Rouge)] focus:bg-white/10
                   transition-all duration-200 min-h-[120px] sm:min-h-[150px] md:min-h-[180px]" rows="4"
            maxlength="500">
          </textarea>
          <div class="absolute bottom-2 right-3 text-xs sm:text-sm text-gray-400">
            {{ newPostContent?.length || 0 }}/500
          </div>
        </div>

        <!-- Zone média -->
        <div class="relative">
          <!-- Aperçu média -->
          <div *ngIf="newPostMediaPreview" class="relative group">
            <div class="relative overflow-hidden rounded-xl">
              <img *ngIf="newPostMedia?.type?.startsWith('image/')" [src]="newPostMediaPreview"
                class="max-h-60 sm:max-h-80 w-full object-cover rounded-xl" />
              <video *ngIf="newPostMedia?.type?.startsWith('video/')" [src]="newPostMediaPreview"
                class="max-h-60 sm:max-h-80 w-full rounded-xl" controls></video>
            </div>

            <!-- Overlay supprimer -->
            <button (click)="removeMedia()" aria-label="Supprimer le média" class="absolute top-3 right-3 bg-black/50 backdrop-blur-sm text-white rounded-full p-2 
                           opacity-0 group-hover:opacity-100 hover:bg-[var(--Rouge)] transition-all duration-200">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>

          <!-- Zone de drop si pas de média -->
          <div *ngIf="!newPostMediaPreview" (drop)="onDrop($event)" (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)" [class.border-[var(--Rouge)]]="isDragging" class="border-2 border-dashed border-gray-600 rounded-xl p-6 sm:p-8 text-center 
                      hover:border-gray-500 hover:bg-white/5 transition-all duration-200 cursor-pointer
                      relative overflow-hidden">

            <input type="file" #mediaInput class="hidden" (change)="onMediaSelected($event)" accept="image/*,video/*" />

            <button (click)="mediaInput.click()" type="button" class="flex flex-col items-center gap-3 w-full">
              <div class="p-3 sm:p-4 bg-white/5 rounded-full">
                <i class="fa-regular fa-image text-3xl sm:text-4xl text-gray-400"></i>
              </div>
              <div class="space-y-1">
                <p class="text-sm sm:text-base font-medium text-white">Ajouter une photo ou vidéo</p>
                <p class="text-xs sm:text-sm text-gray-500">Glissez-déposez ou cliquez pour sélectionner</p>
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row justify-end gap-2 sm:gap-3 mt-6 pt-4 border-t border-white/10">
        <button type="button" (click)="closeCreatePostModal()" class="px-4 sm:px-5 py-2 sm:py-2.5 rounded-xl bg-gray-100 text-gray-800 font-medium
                       hover:bg-gray-200 active:bg-gray-300 transition-all duration-200
                       disabled:opacity-50 disabled:cursor-not-allowed text-sm sm:text-base">
          Annuler
        </button>

        <button type="button" (click)="createPost()" [disabled]="loading || !newPostContent.trim()" class="px-4 sm:px-5 py-2 sm:py-2.5 rounded-xl bg-[var(--Rouge)] text-white font-medium
                       hover:bg-[var(--Rouge-Foncé)] active:scale-95 transition-all duration-200
                       disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-[var(--Rouge)]
                       flex items-center gap-2 min-w-[100px] justify-center text-sm sm:text-base">

          <span *ngIf="!loading" class="flex items-center gap-2">
            <i class="fa-solid fa-check"></i>
            Publier
          </span>

          <span *ngIf="loading" class="flex items-center gap-2">
            <i class="fa-solid fa-spinner fa-spin"></i>
            Publication...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Animations -->
<style>
  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.3s ease-out;
  }

  .animate-slideUp {
    animation: slideUp 0.3s ease-out;
  }
</style>