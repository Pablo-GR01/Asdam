<div class="min-h-screen flex justify-center items-start bg-[var(--Blanc)] p-4 md:p-8">
    <!-- Conteneur central -->
    <div class="w-full max-w-5xl flex flex-col gap-6">

        <!-- ENTÊTE AMÉLIORÉE -->
        <header
            class="-ml-85 -mr-85 flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-6 bg-[var(--Blanc)] backdrop-blur-md rounded-3xl p-6 border-2 border-[var(--Rouge)]">

            <!-- Section gauche -->
            <div class="flex items-center gap-4">
                <div class="w-14 h-14 bg-[var(--Rouge)] rounded-2xl flex items-center justify-center">
                    <i class="fas fa-calendar-alt text-[var(--Blanc)] text-xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-[var(--Black)] bg-clip-text ">
                        Planning Sportif
                    </h1>
                    <p class="text-[var(--Black)] mt-1 font-medium">
                        {{ viewMode === 'month' ? monthLabel() : weekLabel() }}
                    </p>
                </div>
            </div>

            <!-- Contrôles -->
            <div class="flex flex-wrap items-center gap-3">

                <!-- Sélecteur de vue -->
                <div class="bg-gray-100 rounded-2xl p-1.5 flex gap-1 shadow-inner">
                    <button (click)="viewMode = 'month'"
                        [ngClass]="viewMode === 'month' ? 'bg-[var(--Blanc)] text-[var(--Rouge)] shadow-lg scale-105' : 'hover:text-[var(--Blanc)] hover:bg-[var(--Gris)]'"
                        class="px-5 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 flex items-center gap-2">
                        <i class="fas fa-calendar"></i> Mois
                    </button>
                    <button (click)="viewMode = 'week'"
                        [ngClass]="viewMode === 'week' ? 'bg-[var(--Blanc)] text-[var(--Rouge)] shadow-lg scale-105' : 'hover:text-[var(--Blanc)] hover:bg-[var(--Gris)]'"
                        class="px-5 py-2.5 rounded-xl text-sm font-semibold transition-all duration-300 flex items-center gap-2">
                        <i class="fas fa-calendar-week"></i> Semaine
                    </button>
                </div>

                <!-- Navigation -->
                <div class="flex gap-2">
                    <button (click)="viewMode === 'month' ? prevMonth() : prevWeek()"
                        class="w-11 h-11 rounded-2xl bg-gradient-to-br from-[var(--Rouge)] to-[var(--Bleu)] shadow-lg hover:shadow-xl hover:scale-115 transition-all duration-300 flex items-center justify-center group">
                        <i
                            class="fas fa-chevron-left text-[var(--Blanc)] group-hover:text-[var(--Blanc)] transition-colors"></i>
                    </button>
                    <button (click)="viewMode === 'month' ? nextMonth() : nextWeek()"
                        class="w-11 h-11 rounded-2xl bg-gradient-to-br from-[var(--Rouge)] to-[var(--Bleu)] shadow-lg hover:shadow-xl hover:scale-115 transition-all duration-300 flex items-center justify-center group">
                        <i
                            class="fas fa-chevron-right text-[var(--Blanc)] group-hover:text-[var(--Blanc)] transition-colors"></i>
                    </button>
                </div>


            </div>
        </header>

        <!-- BARRE DE RECHERCHE ET FILTRES -->
        <div
            class="-ml-85 -mr-85 mb-2 -mt-6 bg-white backdrop-blur-md rounded-2xl p-4 shadow-xl border-2 border-[var(--Rouge)]">
            <div class="flex flex-col md:flex-row gap-4">

                <!-- Recherche -->
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-[var(--Gris)]"></i>
                    <input type="text" [(ngModel)]="searchTerm" placeholder="Rechercher un événement ou un coach..."
                        class="border-2 border-[var(--Rouge)] w-full pl-12 pr-4 py-3 rounded-xl transition-all duration-300" />
                </div>

                <!-- Filtres -->
                <div class="flex gap-3 flex-wrap">
                    <select [(ngModel)]="selectedCategory"
                        class="px-4 py-3 rounded-xl border-2 border-[var(--Rouge)]  transition-all duration-300">
                        <option value="">Toutes catégories</option>
                        <option *ngFor="let cat of eventTypes" [value]="cat">{{ cat }}</option>
                    </select>

                    <button (click)="clearFilters()"
                        class="px-4 py-3 rounded-xl border-2 border-[var(--Rouge)] bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition-all duration-300 flex items-center gap-2">
                        <i class="fas fa-times"></i>
                        <span class="hidden sm:inline">Effacer</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- CONTENU PRINCIPAL -->
        <div class="-ml-85 -mr-85 flex-1 bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl border-2 border-[var(--Rouge)] overflow-hidden">

            <!-- Indicateur de chargement -->
            <div *ngIf="isLoading" class="flex items-center justify-center h-64">
                <div class="animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"></div>
            </div>

            <!-- VUE MOIS -->
            <div *ngIf="viewMode === 'month' && !isLoading" class="grid grid-cols-7 gap-2 p-4 h-full">
                <div *ngFor="let dayName of ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim']"
                    class="text-center font-bold text-gray-600 py-3 bg-gray-50 rounded-xl">
                    {{ dayName }}
                </div>

                <div *ngFor="let day of monthDays; let i = index" [ngClass]="{
              'bg-gradient-to-br from-white to-gray-50 border-2 border-gray-100 rounded-2xl p-4 hover:border-[var(--Bleu)] hover:shadow-lg transition-all duration-300 cursor-pointer min-h-[160px]': day,
              'bg-transparent': !day,
              'ring-2 ring-blue-500 shadow-lg': isToday(day)
            }" (click)="day && quickAddEvent(day, '09:00')">

                    <div *ngIf="day" class="flex items-center justify-between mb-3">
                        <span [ngClass]="{
                'w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg shadow-md': true,
                'bg-gradient-to-r from-blue-600 to-purple-600 text-white': isToday(day),
                'bg-gray-100 text-gray-700': !isToday(day)
              }">
                            {{ dayNum(day) }}
                        </span>
                        <span *ngIf="getEventCountByDay(day) > 0"
                            class="bg-blue-100 text-blue-800 rounded-full px-3 py-1 text-sm font-semibold">
                            {{ getEventCountByDay(day) }} év.
                        </span>
                    </div>

                    <div *ngIf="day" class="space-y-2 overflow-y-auto max-h-32 custom-scrollbar">
                        <div *ngFor="let evt of getEventsByDay(day)"
                            (click)="$event.stopPropagation(); openEventPopup(evt)"
                            class="group rounded-xl p-3 text-white cursor-pointer transition-all duration-300"
                            [ngClass]="getEventClass(evt)">
                            <div class="flex items-center gap-2">
                                <i [ngClass]="getEventIcon(evt)" class="text-sm"></i>
                                <span class="font-semibold text-sm">{{ evt.hour }}</span>
                                <span class="text-sm truncate">{{ evt.title }}</span>
                            </div>
                            <div class="text-xs opacity-90 mt-1">{{ evt.coach }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VUE SEMAINE -->
            <div *ngIf="viewMode === 'week' && !isLoading" class="grid grid-cols-8 gap-1 p-4 h-full">
                <div class="flex flex-col">
                    <div class="h-16"></div>
                    <div *ngFor="let hour of hours"
                        class="h-20 border-b border-gray-100 text-xs flex items-center justify-center text-gray-500 font-medium">
                        {{ hour }}
                    </div>
                </div>

                <div *ngFor="let day of weekDays"
                    class="flex-1 flex flex-col border-2 border-gray-100 rounded-2xl bg-gradient-to-b from-white to-gray-50 overflow-hidden">
                    <div [ngClass]="{
              'p-4 text-center font-bold sticky top-0 z-10 shadow-sm': true,
              'bg-gradient-to-r from-blue-600 to-purple-600 text-white': isToday(day),
              'bg-gray-50 text-gray-700': !isToday(day)
            }">
                        <div class="text-sm">{{ dayName(day) }}</div>
                        <div class="text-2xl font-bold">{{ dayNum(day) }}</div>
                    </div>

                    <div class="relative flex-1">
                        <div *ngFor="let hour of hours"
                            class="h-20 border-b border-gray-100 relative group hover:bg-blue-50 transition-colors cursor-pointer"
                            (click)="quickAddEvent(day, hour)">
                            <div *ngFor="let evt of getEventsByHour(day, hour); let i = index"
                                (click)="$event.stopPropagation(); openEventPopup(evt)"
                                class="absolute left-2 right-2 rounded-xl p-3 text-white cursor-pointer transition-all duration-300 hover:scale-105 hover:shadow-xl z-20"
                                [ngClass]="getEventClass(evt)"
                                [ngStyle]="{'top': '8px', 'height': 'calc(' + getEventHeight(evt) + ' - 16px)'}">

                                <div class="flex items-center gap-2 font-bold text-sm mb-1">
                                    <i [ngClass]="getEventIcon(evt)"></i>
                                    <span class="truncate">{{ evt.title }}</span>
                                </div>
                                <div class="text-xs opacity-90 flex justify-between">
                                    <span>{{ evt.coach }}</span>
                                    <span>{{ evt.duration }}h</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- POPUP MODAL -->
        <div *ngIf="showPopup"
            class="fixed inset-0 bg-black/60 backdrop-blur-md flex items-center justify-center z-50 p-4 animate-fadeIn">
            <div
                class="bg-white rounded-3xl p-8 max-w-lg w-full shadow-2xl transform animate-scaleIn border border-white/20 overflow-y-auto max-h-[90vh]">

                <!-- Bouton fermer -->
                <button (click)="closePopup()"
                    class="absolute top-6 right-6 w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 hover:text-gray-800 transition-all duration-300 group">
                    <i class="fas fa-times group-hover:rotate-90 transition-transform"></i>
                </button>

                <!-- Formulaire création -->
                <div *ngIf="!popupEvent" class="space-y-5">
                    <h2
                        class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-6">
                        Créer un événement
                    </h2>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Date</label>
                            <input type="date" [(ngModel)]="newEventDate"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Heure début</label>
                            <input type="time" [(ngModel)]="newEventHour"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300" />
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Heure fin</label>
                            <input type="time" [(ngModel)]="newEventEndHour"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300" />
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Titre</label>
                        <input type="text" [(ngModel)]="newEventTitle" placeholder="Titre de l'événement"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300" />
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Coach</label>
                        <input type="text" [(ngModel)]="newEventCoach" placeholder="Nom du coach"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300" />
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Type</label>
                            <select [(ngModel)]="newEventCategory"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300">
                                <option value="">Sélectionner un type</option>
                                <option *ngFor="let type of eventTypes" [value]="type">{{ type }}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Catégorie</label>
                            <select [(ngModel)]="newEventLevel"
                                class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-blue-500 focus:ring-4 focus:ring-blue-200 transition-all duration-300">
                                <option value="">Sélectionner une catégorie</option>
                                <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                            </select>
                        </div>
                    </div>

                    <button (click)="addEvent()"
                        class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold py-4 rounded-2xl hover:shadow-2xl hover:scale-105 transition-all duration-300 flex items-center justify-center gap-3 group">
                        <i class="fas fa-plus group-hover:rotate-90 transition-transform"></i>
                        Ajouter l'événement
                    </button>
                </div>

                <!-- Détails d'un événement -->
                <div *ngIf="popupEvent" class="space-y-4">
                    <h2
                        class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-6">
                        Détails de l'événement
                    </h2>

                    <div class="space-y-4">
                        <div class="bg-gray-50 rounded-xl p-4">
                            <p class="text-gray-700 mb-2"><strong class="text-gray-900">Titre :</strong> {{
                                popupEvent.title }}</p>
                            <p class="text-gray-700 mb-2"><strong class="text-gray-900">Coach :</strong> {{
                                popupEvent.coach }}</p>
                            <p class="text-gray-700 mb-2"><strong class="text-gray-900">Date :</strong> {{
                                popupEvent.day | date:'fullDate':'fr' }}</p>
                            <p class="text-gray-700 mb-2"><strong class="text-gray-900">Heure :</strong> {{
                                popupEvent.hour }} - {{ popupEvent.endHour }}</p>
                            <p class="text-gray-700 mb-2"><strong class="text-gray-900">Type :</strong> {{
                                popupEvent.category }}</p>
                            <p class="text-gray-700 mb-2"><strong class="text-gray-900">Catégorie :</strong> {{
                                popupEvent.level }}</p>
                            <!-- <p class="text-gray-700"><strong class="text-gray-900">Durée :</strong> {{ popupEvent.duration }} heure(s)</p> -->
                        </div>

                        <div class="flex gap-3">
                            <button (click)="closePopup()"
                                class="flex-1 bg-gray-100 text-gray-700 font-semibold py-3 rounded-xl hover:bg-gray-200 transition-all duration-300">
                                Fermer
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>