<app-icon></app-icon>

<!-- ====== ACCESSIBILITY HELPERS ====== -->
<span id="menu-label" class="sr-only">Navigation principale</span>

<header class="sticky top-0 z-50 w-full bg-white/80 backdrop-blur-lg shadow-sm">
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
    <div class="flex h-20 items-center justify-between">

      <!-- BURGER MOBILE -->
      <button type="button"
              class="lg:hidden p-2 rounded-lg text-slate-700 hover:bg-slate-100"
              aria-label="Ouvrir le menu"
              aria-expanded="false"
              (click)="toggleMobileMenu()">
        <i class="fas fa-bars text-xl"></i>
      </button>

      <!-- NAV GAUCHE -->
      <nav class="hidden lg:flex lg:gap-2" aria-labelledby="menu-label">
        <div *ngFor="let menu of mobileMenus.slice(0,3)"
             class="relative flex items-center group">

          <!-- Lien principal -->
          <a [routerLink]="menu.link || (menu.items.length ? menu.items[0].link : '/PlanningC')"
             class="flex items-center gap-2 rounded-lg px-3 py-2 text-slate-700 hover:text-[var(--Rouge)] transition">
            <i [class]="menu.icon"></i>
            <span>{{ menu.title }}</span>
          </a>

          <!-- Flèche pour dropdown -->
          <button type="button"
                  *ngIf="menu.items.length"
                  (click)="toggleDropdown(menu.title,$event)"
                  class="ml-1 p-1 rounded text-slate-500 hover:text-[var(--Rouge)]"
                  [attr.aria-expanded]="activeDropdown===menu.title">
            <i class="fas fa-chevron-down text-xs transition-transform"
               [class.-rotate-180]="activeDropdown===menu.title"></i>
          </button>

          <!-- Dropdown -->
          <div *ngIf="activeDropdown===menu.title"
               class="absolute left-0 top-full mt-2 w-56 rounded-xl bg-white shadow-lg p-2 animate-fade-in">
            <a *ngFor="let item of menu.items"
               [routerLink]="item.link"
               class="flex items-center gap-2 justify-between rounded-lg px-3 py-2 text-sm text-slate-700 hover:bg-[var(--Rouge)] hover:text-white"
               (click)="closeDropdown(menu.title)">
              <span class="flex items-center gap-2">
                <i [class]="item.icon"></i>
                {{ item.title }}
              </span>
              <!-- COMPTEUR CONVOCATIONS -->
              <span *ngIf="item === convocationsMenuItem && item.count && item.count > 0"
                    class="inline-flex items-center justify-center px-2 py-0.5 text-xs font-bold leading-none text-white bg-red-600 rounded-full">
                {{ item.count }}
              </span>
            </a>
          </div>
        </div>
      </nav>

      <!-- LOGO -->
      <a routerLink="/accueilC"
         class="flex items-center justify-center group focus:outline-none focus:ring-2 focus:ring-[var(--Rouge)] rounded-full">
        <img src="assets/LOGO.png"
             alt="Accueil"
             class="h-12 w-12 sm:h-14 sm:w-14 object-contain transition-transform group-hover:scale-110">
      </a>

      <!-- NAV DROITE -->
      <nav class="hidden lg:flex lg:gap-2">
        <div *ngFor="let menu of mobileMenus.slice(3,6)"
             class="relative flex items-center group">
          <a [routerLink]="menu.link || (menu.items.length ? menu.items[0].link : '/')"
             class="flex items-center gap-2 rounded-lg px-3 py-2 text-slate-700 hover:text-[var(--Rouge)] transition">
            <i [class]="menu.icon"></i>
            <span>{{ menu.title }}</span>
          </a>

          <button type="button"
                  *ngIf="menu.items.length"
                  (click)="toggleDropdown(menu.title,$event)"
                  class="ml-1 p-1 rounded text-slate-500 hover:text-[var(--Rouge)]"
                  [attr.aria-expanded]="activeDropdown===menu.title">
            <i class="fas fa-chevron-down text-xs transition-transform"
               [class.-rotate-180]="activeDropdown===menu.title"></i>
          </button>

          <!-- Dropdown droite -->
          <div *ngIf="activeDropdown===menu.title"
               class="absolute right-0 top-full mt-2 w-56 rounded-xl bg-white shadow-lg p-2 animate-fade-in">
            <a *ngFor="let item of menu.items"
               [routerLink]="item.link"
               class="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-slate-700 hover:bg-[var(--Rouge)] hover:text-white"
               (click)="closeDropdown(menu.title)">
              <i [class]="item.icon"></i>
              <span>{{ item.title }}</span>
            </a>
          </div>
        </div>
      </nav>

      <!-- PROFIL MOBILE -->
      <a routerLink="/dashboardC"
         class="lg:hidden ml-auto p-2 rounded-full text-slate-700 hover:bg-slate-100"
         aria-label="Mon compte">
        <i class="fas fa-user-circle text-xl"></i>
      </a>
    </div>
  </div>

  <!-- PANNEAU MOBILE -->
  <div *ngIf="mobileMenuOpen"
       class="fixed inset-0 z-50 bg-white/95 backdrop-blur-md overflow-auto">
    <nav class="flex flex-col gap-6 px-6 py-12 h-full justify-center items-center">
      <a *ngFor="let menu of mobileMenus"
         [routerLink]="menu.link || (menu.items.length ? menu.items[0].link : '/')"
         class="flex items-center gap-3 text-2xl font-semibold text-slate-700 hover:text-[var(--Rouge)] rounded-lg px-4 py-2"
         (click)="closeMobileMenu()">
        <i [class]="menu.icon"></i>
        <span>{{ menu.title }}</span>
      </a>
      <button (click)="deconnecter()"
              class="flex items-center gap-3 text-2xl font-semibold text-slate-700 hover:text-[var(--Rouge)] rounded-lg px-4 py-2">
        <i class="fas fa-sign-out-alt"></i>
        <span>Déconnexion</span>
      </button>
    </nav>
  </div>
</header>
